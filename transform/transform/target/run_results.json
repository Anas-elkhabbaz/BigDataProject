{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-11-30T22:36:08.292878Z", "invocation_id": "f0151bed-0156-4d11-b9f6-2039de282562", "invocation_started_at": "2025-11-30T22:35:43.008416Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-30T22:36:08.069346Z", "completed_at": "2025-11-30T22:36:08.089530Z"}, {"name": "execute", "started_at": "2025-11-30T22:36:08.091003Z", "completed_at": "2025-11-30T22:36:08.091055Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.036954641342163086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.irrigation.src_weather_forecast_daily", "compiled": true, "compiled_code": "-- models/src/src_weather_forecast_daily.sql\r\n\r\nwith src as (\r\n\r\n    select\r\n        cast(date as date)           as date,\r\n        cast(date_epoch as bigint)   as date_epoch,\r\n        cast(tmax_c as double)       as tmax_c,\r\n        cast(tmin_c as double)       as tmin_c,\r\n        cast(tavg_c as double)       as tavg_c,\r\n        cast(precip_mm as double)    as precip_mm,\r\n        cast(humidity as double)     as humidity,\r\n        cast(condition as varchar)   as condition,\r\n        cast(uv as double)           as uv\r\n    from read_csv_auto('../raw/weather_forecast_daily.csv', header = true)\r\n\r\n)\r\n\r\nselect *\r\nfrom src", "relation_name": "\"irrigation\".\"main\".\"src_weather_forecast_daily\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-30T22:36:08.058328Z", "completed_at": "2025-11-30T22:36:08.095770Z"}, {"name": "execute", "started_at": "2025-11-30T22:36:08.097596Z", "completed_at": "2025-11-30T22:36:08.097615Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04451870918273926, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.irrigation.src_weather_daily", "compiled": true, "compiled_code": "\ufeff\n\nwith raw as (\n  select *\n  from read_csv('/app/raw/weather_daily.csv',\n    auto_detect = false,\n    header      = true,\n    delim       = ',',\n    quote       = '\"',\n    escape      = '\"',\n    -- Relax the parser for real-world CSVs:\n    strict_mode = false,\n    -- Let DuckDB read everything as text; stg will cast:\n    sample_size = -1,\n    ignore_errors = true,\n    columns = {\n      'date' : 'VARCHAR',\n      'tavg' : 'VARCHAR',\n      'tmin' : 'VARCHAR',\n      'tmax' : 'VARCHAR',\n      'prcp' : 'VARCHAR',\n      'snow' : 'VARCHAR',\n      'wdir' : 'VARCHAR',\n      'wspd' : 'VARCHAR',\n      'wpgt' : 'VARCHAR',\n      'pres' : 'VARCHAR',\n      'tsun' : 'VARCHAR',\n      'lat'  : 'VARCHAR',\n      'lon'  : 'VARCHAR'\n    }\n  )\n)\nselect *\nfrom raw\n-- keep only rows that have a date value\nwhere date is not null and trim(date) <> ''\norder by date", "relation_name": "\"irrigation\".\"main\".\"src_weather_daily\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-30T22:36:08.099394Z", "completed_at": "2025-11-30T22:36:08.127428Z"}, {"name": "execute", "started_at": "2025-11-30T22:36:08.129005Z", "completed_at": "2025-11-30T22:36:08.129043Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03455948829650879, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.irrigation.stg_weather_forecast_daily", "compiled": true, "compiled_code": "\n\nselect\n    cast(date as date)                         as date,\n    cast(date_epoch as bigint)                 as date_epoch,\n    cast(tmax_c as double)                     as tmax_c,\n    cast(tmin_c as double)                     as tmin_c,\n    cast(tavg_c as double)                     as tavg_c,\n    cast(precip_mm as double)                  as precip_mm,\n    cast(humidity as double)                   as humidity,\n    condition                                  as condition_text,\n    cast(uv as double)                         as uv\nfrom \"irrigation\".\"main\".\"src_weather_forecast_daily\"", "relation_name": "\"irrigation\".\"main\".\"stg_weather_forecast_daily\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-30T22:36:08.109428Z", "completed_at": "2025-11-30T22:36:08.133442Z"}, {"name": "execute", "started_at": "2025-11-30T22:36:08.134855Z", "completed_at": "2025-11-30T22:36:08.134878Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02858710289001465, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.irrigation.stg_weather_daily", "compiled": true, "compiled_code": "\ufeff\n\n-- Step 0: read from src\nwith base as (\n  select *\n  from \"irrigation\".\"main\".\"src_weather_daily\"\n),\n\n-- Step 1: robust date parsing from text\nparsed as (\n  select\n    coalesce(\n      try_cast(date as date),              -- 'YYYY-MM-DD'\n      try_strptime(date, '%y-%m-%d')::date,        -- 'YY-MM-DD' -> 20YY\n      try_strptime(concat('20', date), '%Y-%m-%d')::date\n    ) as parsed_date,\n\n    -- keep original text cols for numeric casting below\n    tavg, tmin, tmax, prcp, snow, wdir, wspd, wpgt, pres, tsun, lat, lon\n  from base\n),\n\n-- Step 2: guard against ancient years (e.g., 0025 -> 2025)\ns as (\n  select\n    case\n      when parsed_date is not null and extract(year from parsed_date) < 1900\n        then parsed_date + interval 2000 years\n      else parsed_date\n    end as date,\n\n    -- your existing numeric casting (unchanged)\n    try_cast(nullif(tavg,'') as double) as tavg,\n    try_cast(nullif(tmin,'') as double) as tmin,\n    try_cast(nullif(tmax,'') as double) as tmax,\n    try_cast(nullif(prcp,'') as double) as prcp,\n    try_cast(nullif(snow,'') as double) as snow,\n    try_cast(nullif(wdir,'') as double) as wdir,\n    try_cast(nullif(wspd,'') as double) as wspd,\n    try_cast(nullif(wpgt,'') as double) as wpgt,\n    try_cast(nullif(pres,'') as double) as pres,\n    try_cast(nullif(tsun,'') as double) as tsun,\n    try_cast(nullif(lat,'')  as double) as lat,\n    try_cast(nullif(lon,'')  as double) as lon\n  from parsed\n)\n\nselect *\nfrom s\nwhere date is not null", "relation_name": "\"irrigation\".\"main\".\"stg_weather_daily\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-30T22:36:08.142260Z", "completed_at": "2025-11-30T22:36:08.173634Z"}, {"name": "execute", "started_at": "2025-11-30T22:36:08.175314Z", "completed_at": "2025-11-30T22:36:08.175341Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03619694709777832, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.irrigation.mart_weather_features", "compiled": true, "compiled_code": "\ufeff\n\nwith d as (\n  select\n    date,\n    tavg, tmin, tmax, prcp, snow, wdir, wspd, wpgt, pres, tsun, lat, lon\n  from \"irrigation\".\"main\".\"stg_weather_daily\"\n),\n\nfeat as (\n  select\n    *,\n    sum(coalesce(prcp, 0.0)) over(order by date rows between 6  preceding and current row)  as prcp_7d,\n    sum(coalesce(prcp, 0.0)) over(order by date rows between 13 preceding and current row)  as prcp_14d,\n    sum(coalesce(prcp, 0.0)) over(order by date rows between 29 preceding and current row)  as prcp_30d,\n    avg(tavg)              over(order by date rows between 6  preceding and current row)    as tavg_7d,\n    max(tmax)              over(order by date rows between 6  preceding and current row)    as tmax_7d,\n    (coalesce(prcp, 0.0) = 0.0)                                                              as is_dry_day,\n    (coalesce(tmax, -1e9) >= 32)                                                             as is_hot_day\n  from d\n)\n\nselect\n  *,\n  case when prcp_7d < 10 and tavg_7d >= 20 then true else false end as should_irrigate\nfrom feat\norder by date", "relation_name": "\"irrigation\".\"main\".\"mart_weather_features\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-30T22:36:08.190397Z", "completed_at": "2025-11-30T22:36:08.269663Z"}, {"name": "execute", "started_at": "2025-11-30T22:36:08.271503Z", "completed_at": "2025-11-30T22:36:08.271526Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.08941006660461426, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.irrigation.mart_irrigation_calendar", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        date::date                         as calendar_date,\n        -- TODO: remplacer par un vrai region_key plus tard\n        'default_region'::text             as region_key,\n        tavg,\n        tmin,\n        tmax,\n        prcp,\n        prcp_7d,\n        tavg_7d,\n        is_dry_day,\n        is_hot_day,\n        should_irrigate\n    from \"irrigation\".\"main\".\"mart_weather_features\"\n),\n\nwith_window as (\n    select\n        calendar_date,\n        region_key,\n        tavg,\n        tmin,\n        tmax,\n        prcp,\n        prcp_7d,\n        tavg_7d,\n        is_dry_day,\n        is_hot_day,\n        should_irrigate,\n        -- offset relatif \u00e0 aujourd'hui\n        datediff('day', current_date, calendar_date) as day_offset,\n        case\n            when calendar_date <  current_date then 'PAST'\n            when calendar_date =  current_date then 'TODAY'\n            else 'FUTURE'\n        end as period_type\n    from base\n)\n\nselect *\nfrom with_window\nwhere calendar_date between current_date - 7\n                        and current_date + 7\norder by calendar_date", "relation_name": "\"irrigation\".\"main\".\"mart_irrigation_calendar\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-30T22:36:08.196803Z", "completed_at": "2025-11-30T22:36:08.277708Z"}, {"name": "execute", "started_at": "2025-11-30T22:36:08.279166Z", "completed_at": "2025-11-30T22:36:08.279187Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.09570169448852539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.irrigation.unique_mart_weather_features_date.b3ca6bd19a", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    date as unique_field,\n    count(*) as n_records\n\nfrom \"irrigation\".\"main\".\"mart_weather_features\"\nwhere date is not null\ngroup by date\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-30T22:36:08.208043Z", "completed_at": "2025-11-30T22:36:08.282981Z"}, {"name": "execute", "started_at": "2025-11-30T22:36:08.284383Z", "completed_at": "2025-11-30T22:36:08.284403Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.09948945045471191, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.irrigation.not_null_mart_weather_features_date.917fc1cd81", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect date\nfrom \"irrigation\".\"main\".\"mart_weather_features\"\nwhere date is null\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 4.631292104721069, "args": {"empty_catalog": false, "favor_state": false, "profiles_dir": "/app/transform/profiles/duckdb", "require_explicit_package_overrides_for_builtin_materializations": true, "write_json": true, "target_path": "transform/target", "warn_error_options": {"error": [], "warn": [], "silence": []}, "populate_cache": true, "vars": {}, "require_all_warnings_handled_by_warn_error": false, "introspect": true, "defer": false, "select": [], "cache_selected_only": false, "log_file_max_bytes": 10485760, "printer_width": 80, "require_nested_cumulative_type_params": false, "static": false, "show_all_deprecations": false, "project_dir": "/app/transform", "compile": true, "version_check": true, "print": true, "exclude": [], "source_freshness_run_project_hooks": true, "upload_to_artifacts_ingest_api": false, "log_level_file": "debug", "invocation_command": "dbt docs generate", "use_fast_test_edges": false, "which": "generate", "quiet": false, "indirect_selection": "eager", "show_resource_report": false, "log_level": "info", "skip_nodes_if_on_run_start_fails": false, "static_parser": true, "state_modified_compare_more_unrendered_values": false, "partial_parse_file_diff": true, "partial_parse": true, "require_yaml_configuration_for_mf_time_spines": false, "strict_mode": false, "use_colors": true, "send_anonymous_usage_stats": true, "log_format": "default", "macro_debugging": false, "state_modified_compare_vars": false, "log_format_file": "debug", "require_resource_names_without_spaces": true, "require_generic_test_arguments_property": true, "use_colors_file": true, "validate_macro_args": false, "require_batched_execution_for_custom_microbatch_strategy": false, "log_path": "/app/transform/logs"}}